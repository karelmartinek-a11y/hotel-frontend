{% extends "base.html" %}

{% block title %}Hotel App – {{ role_title }}{% endblock %}

{% block head_extra %}
  <link rel="stylesheet" href="/static/hotel-webapp.css" />
  <script defer src="/static/hotel-webapp.js"></script>
{% endblock %}

{% block content %}
<div
  class="webapp-shell"
  data-webapp
  data-role="{{ role_key }}"
  data-device-class="{{ device_class }}"
  data-rooms='{{ rooms | tojson }}'
>
  <div class="webapp-wrap webapp-grid">
    <div class="webapp-card sticky">
      <div class="webapp-header">
        <div class="webapp-title">
          <img
            src="{{ url_for('static', path='asc_logo.png') }}"
            alt="KájovoHotel"
            style="width:56px;height:56px;object-fit:contain;"
          />
          <div>
            <h1>KájovoHotel</h1>
            <p>Interní hlášení • Pokojská / Recepce / Údržba</p>
          </div>
        </div>
        <span class="role-chip">{{ role_title }}</span>
      </div>

      <div class="webapp-card" style="box-shadow:none;padding:0;border:none;">
        <div class="form-row" style="justify-content:space-between;">
          <span class="status-pill" data-status-pill data-status="UNKNOWN">Načítám</span>
          <span class="webapp-muted">Device ID: <strong data-device-id>—</strong></span>
        </div>
        <div class="webapp-muted" data-status-text></div>
      </div>

      <div class="webapp-note" data-activation-note>
        Zařízení čeká na aktivaci. Požádejte administrátora o povolení zařízení v administraci Hotelu.
      </div>

      <div class="webapp-note webapp-hidden" data-error-box></div>
      <div class="webapp-note webapp-hidden" data-success-box></div>

      <div class="webapp-actions">
        <a class="webapp-button ghost" href="/">Zpět na úvod</a>
        <a class="webapp-button ghost" href="/admin">Admin</a>
      </div>
    </div>

    <div class="webapp-card" data-action-area>
      {% if role_key == 'housekeeping' %}
      <h2>Nové hlášení</h2>
      <p class="webapp-muted">Vyfoťte nález nebo závadu a přiřaďte pokoj.</p>
      <form class="form-grid" data-housekeeping-form>
        <div>
          <label class="label">Typ hlášení</label>
          <div class="form-row">
            <label class="webapp-button ghost">
              <input type="radio" name="type" value="FIND" data-report-type checked />
              Nález
            </label>
            <label class="webapp-button ghost">
              <input type="radio" name="type" value="ISSUE" data-report-type />
              Závada
            </label>
          </div>
        </div>

        <div>
          <label class="label">Fotografie</label>
          <div class="photo-actions-mobile">
            <button type="button" class="webapp-button primary" data-photo-camera-btn>Vyfotit</button>
            <button type="button" class="webapp-button ghost" data-photo-gallery-btn>Vybrat z galerie</button>
          </div>
          <div class="photo-actions-desktop">
            <button type="button" class="webapp-button primary" data-photo-desktop-btn>Připojit fotky</button>
          </div>
          <input type="file" accept="image/*" capture="environment" multiple class="webapp-hidden" data-photo-camera-input />
          <input type="file" accept="image/*" multiple class="webapp-hidden" data-photo-gallery-input />
          <input type="file" accept="image/*" multiple class="webapp-hidden" data-photo-desktop-input />
          <div class="webapp-muted" style="margin-top:6px;">Vybráno: <strong data-photo-count>0/5</strong></div>
          <div class="photo-strip" data-photo-preview></div>
        </div>

        <div>
          <label class="label">Popis (volitelné)</label>
          <input class="input" type="text" maxlength="50" placeholder="Např. zapomenutý telefon" data-description />
          <div class="webapp-muted">Počet znaků: <strong data-desc-count>0/50</strong></div>
        </div>

        <div>
          <label class="label">Pokoj</label>
          <div class="room-grid" data-room-grid>
            {% for room in rooms %}
            <button type="button" class="room-tile" data-room="{{ room }}">{{ room }}</button>
            {% endfor %}
          </div>
        </div>

        <div class="webapp-actions">
          <button class="webapp-button primary" type="submit">Odeslat hlášení</button>
          <button class="webapp-button ghost" type="button" onclick="window.location.reload()">Resetovat</button>
        </div>
      </form>
      {% elif role_key == 'frontdesk' %}
      <h2>Otevřené nálezy</h2>
      <p class="webapp-muted">Seznam nálezů čekajících na vyřízení recepcí.</p>
      <div class="webapp-actions">
        <button class="webapp-button ghost" type="button" data-refresh-reports>Aktualizovat</button>
      </div>
      <div class="report-list" data-report-list></div>
      {% elif role_key == 'maintenance' %}
      <h2>Otevřené závady</h2>
      <p class="webapp-muted">Seznam závad čekajících na vyřízení údržbou.</p>
      <div class="webapp-actions">
        <button class="webapp-button ghost" type="button" data-refresh-reports>Aktualizovat</button>
      </div>
      <div class="report-list" data-report-list></div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
